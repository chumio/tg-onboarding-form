<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Employee Onboarding</title>
  <style>
    body { font-family: -apple-system, system-ui, Arial, sans-serif; background:#f2f4f7; padding:32px; }
    form { max-width: 560px; margin: 0 auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.08); }
    label { display:block; font-weight:700; margin-top:18px; }
    input[type="text"], input[type="email"], input[type="tel"] {
      width:100%; padding:12px 14px; margin-top:8px; border:1px solid #d0d7e2; border-radius:10px; box-sizing:border-box;
    }
    button { width:100%; margin-top:22px; padding:12px 16px; border:none; border-radius:10px; background:#0b5ed7; color:#fff; font-size:20px; font-weight:700; cursor:pointer; }
    button:hover { background:#094fb5; }
    .msg { margin-top:12px; font-size:14px; }
    .ok { color:#0a7e07; }
    .err { color:#c0392b; }
    small { color:#667085 }
  </style>
</head>
<body>
  <form id="onboardingForm">
    <label for="name">Name</label>
    <input id="name" name="name" type="text" placeholder="Jane Citizen" required />

    <label for="mobile">Mobile</label>
    <input id="mobile" name="mobile" type="tel" placeholder="04xx xxx xxx" required />
    <small>Digits/spaces will be normalised to +61 format.</small>

    <label for="email">Email</label>
    <input id="email" name="email" type="email" placeholder="jane@example.com" required />

    <button type="submit">Submit</button>
    <div id="msg" class="msg"></div>
  </form>

  <script>
    // --- CONFIG: your local relay URL ---
    const WEBHOOK_URL = "http://localhost:8080/api/onboard";
    const WEBHOOK_BEARER = ""; // e.g. "Bearer MyToken" if you set API_BEARER in the relay

    function normaliseAUMobile(raw) {
      if (!raw) return "";
      let s = (""+raw).replace(/[^0-9]/g,"");
      if (s.startsWith("04") && s.length === 10) return "+61" + s.slice(1);
      if (s.startsWith("614") && s.length === 11) return "+" + s;
      return s;
    }
    function validEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

    const form = document.getElementById("onboardingForm");
    const msg  = document.getElementById("msg");
    const btn  = form.querySelector("button[type='submit']");

    function showOk(t){ msg.textContent = t; msg.className = "msg ok"; }
    function showErr(t){ msg.textContent = t; msg.className = "msg err"; }

    form.addEventListener("submit", async (ev) => {
      ev.preventDefault();
      msg.textContent = "";

      const name   = document.getElementById("name").value.trim();
      const mobile = normaliseAUMobile(document.getElementById("mobile").value);
      const email  = document.getElementById("email").value.trim();

      if (!name) return showErr("Please enter a name");
      if (!mobile) return showErr("Please enter a mobile");
      if (!validEmail(email)) return showErr("Please enter a valid email");

      const [firstName, ...rest] = name.split(" ");
      const secondName = rest.join(" ");

      // Use FileMaker field names your layout expects
      const payload = {
        FirstName: firstName,
        SecondName: secondName,
        MobileNumber: mobile,
        Email: email,
        source: "onboarding-mini-form",
        submittedAt: new Date().toISOString()
      };

      try {
        btn.disabled = true;
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            ...(WEBHOOK_BEARER ? {"Authorization": WEBHOOK_BEARER} : {})
          },
          body: JSON.stringify(payload)
        });
        if (!res.ok) {
          const txt = await res.text().catch(()=> "");
          throw new Error(`HTTP ${res.status} ${txt}`);
        }
        showOk("Saved. Thanks.");
        form.reset();
      } catch (e) {
        showErr("Could not submit. Check endpoint/CORS: " + e.message);
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
