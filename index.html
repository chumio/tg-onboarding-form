<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Employee Onboarding</title>
  <style>
    :root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    body { background:#0b0f14; color:#e6edf3; display:grid; place-items:center; min-height:100svh; margin:0; }
    .card { width: min(560px, 92vw); background:#0f1721; border:1px solid #1f2a37; border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); padding:24px; }
    h1 { margin:0 0 8px; font-size:1.4rem; }
    p.hint { margin:0 0 20px; color:#9fb0c2; font-size:.95rem; }
    label { display:block; font-size:.9rem; color:#bfd3e6; margin:.6rem 0 .25rem; }
    input { width:100%; background:#0b121a; color:#e6edf3; border:1px solid #203042; border-radius:12px; padding:12px 14px; outline:none; }
    input:focus { border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.25); }
    .row { display:grid; grid-template-columns: 1fr; gap:12px; }
    .btn { width:100%; margin-top:14px; padding:12px 16px; border-radius:12px; border:none; cursor:pointer; font-weight:600; background:#3b82f6; color:white; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    .msg { margin-top:12px; font-size:.95rem; }
    .ok { color:#67e8f9; }
    .err { color:#fca5a5; }
    small { color:#9fb0c2; }
  </style>
</head>
<body>
  <main class="card">
    <h1>New Employee</h1>
    <p class="hint">Enter details then submit. Minimal demo with three fields.</p>

    <form id="onboardForm" novalidate>
      <div class="row">
        <div>
          <label for="name">Name</label>
          <input id="name" name="name" placeholder="Jane Citizen" autocomplete="name" required />
        </div>
        <div>
          <label for="mobile">Mobile</label>
          <input id="mobile" name="mobile" placeholder="04xx xxx xxx" inputmode="tel" autocomplete="tel" required />
          <small>Digits and spaces only. We'll normalise to +61.</small>
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" placeholder="jane@example.com" type="email" autocomplete="email" required />
        </div>
      </div>
      <button class="btn" id="submitBtn" type="submit">Submit</button>
      <div class="msg" id="msg"></div>
    </form>
  </main>

<script>
  // LIVE endpoint
  const WEBHOOK_URL = "https://tg-onboarding-relay.onrender.com/api/onboard";
  const WEBHOOK_BEARER = ""; // optional

  function normaliseAUMobile(raw) {
    if (!raw) return "";
    let s = (""+raw).replace(/[^0-9]/g, "");
    if (s.startsWith("04") && s.length === 10) return "+61" + s.slice(1);
    if (s.startsWith("614") && s.length === 11) return "+" + s;
    return s;
  }

  function validEmail(e) { return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(e); }

  const form = document.getElementById('onboardForm');
  const msg  = document.getElementById('msg');
  const btn  = document.getElementById('submitBtn');

  form.addEventListener('submit', async (ev) => {
    ev.preventDefault();
    msg.textContent = "";

    const name   = document.getElementById('name').value.trim();
    const mobile = normaliseAUMobile(document.getElementById('mobile').value);
    const email  = document.getElementById('email').value.trim();

    if (!name) return showErr("Please enter a name");
    if (!mobile) return showErr("Please enter a mobile");
    if (!validEmail(email)) return showErr("Please enter a valid email");

    const payload = { name, mobile, email, source: "onboarding-mini-form", submittedAt: new Date().toISOString() };

    try {
      btn.disabled = true;
      const res = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...(WEBHOOK_BEARER ? { 'Authorization': WEBHOOK_BEARER } : {}) },
        body: JSON.stringify(payload)
      });

      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      showOk('Saved. Thanks.');
      form.reset();
    } catch (e) {
      showErr('Could not submit. ' + e.message);
    } finally {
      btn.disabled = false;
    }
  });

  function showOk(t){ msg.textContent = t; msg.className = 'msg ok'; }
  function showErr(t){ msg.textContent = t; msg.className = 'msg err'; }
</script>
</body>
</html>
